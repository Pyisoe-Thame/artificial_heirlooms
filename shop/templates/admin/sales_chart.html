<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sales Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <div id="chart-container" data-url="{% url 'get_sales_data' 'interval_placeholder' %}" style="width: 900px; height: 600px;">
        <h2>Sales Statistics</h2>
        <label for="interval">Choose Interval:</label>
        <select id="interval">
            <option value="day">Day</option>
            <option value="month">Month</option>
            <option value="year">Year</option>
        </select>
        
        <canvas id="salesChart"></canvas>
    </div>    

<script>
    const ctx = document.getElementById('salesChart').getContext('2d');
    let salesChart;

    // Initialize chart
    function initializeChart(labels, data) {

        // sort labels and data based on chronological order
        const sortedData = labels.map((label, index) => ({ label: label, value: data[index] }))
            .sort((a, b) => new Date(a.label) - new Date(b.label));

        const sortedLabels = sortedData.map(item => item.label);
        const sortedValues = sortedData.map(item => item.value);

        if (salesChart) salesChart.destroy();
        salesChart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: sortedLabels,
                datasets: [{
                    label: 'Sales',
                    data: sortedValues,
                    backgroundColor: 'rgba(0, 99, 132, 0.6)',
                    borderColor: 'rgba(0, 99, 132, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                // maintainAspectRatio: false,  // allows custom dimensions
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    }

    // Fetch data for the selected interval
    function updateChart(interval) {
        // Get the base URL from the data attribute
        const urlTemplate = document.getElementById('chart-container').dataset.url;
        // Replace 'interval_placeholder' with the actual interval
        const url = urlTemplate.replace('interval_placeholder', interval);

        fetch(url)
            .then(response => response.json())
            .then(data => {
                initializeChart(data.labels, data.data);
            });
    }

    // Update chart when interval changes
    document.getElementById('interval').addEventListener('change', function() {
        updateChart(this.value);
    });

    // Load initial chart
    updateChart('day');  // Default to 'day' interval
</script>

</body>
</html>

